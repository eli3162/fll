<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>
        Metadata
    </title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            overflow: hidden;
        }
        /* full-page backdrop */
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url('/assets/page_bg.svg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -2;
            opacity: 1;
            pointer-events: none;
        }
        .split {
            display: flex;
            width: 100vw;
            height: 100vh;
            margin: 0;
            position: relative;
            z-index: 1;
        }
        .split .left,
        .split .right {
            flex: 1 1 50%;
            position: relative;
            overflow: hidden;
            min-width: 0;
        }
        .split .left model-viewer {
            width: 100%;
            height: 100%;
            display: block;
        }
        .split .right .background {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        @media (max-width: 700px) {
            .split {
                flex-direction: column;
                height: 100vh;
            }
            .split .left,
            .split .right {
                height: 50vh;
            }
        }
    </style>
</head>
<body>

    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.1.0/model-viewer.min.js"></script>
    <div class="split">
        <div class="left">
            <model-viewer id="artifactViewer" alt="Artifact" src="" ar environment-image="" poster="" shadow-intensity="1" camera-controls touch-action="pan-y"></model-viewer>
        </div>
        <div class="right" id="metadata">
            <p>Loading metadata...</p>
        </div>
    </div>
</body>
</html>

<script>
    function getAssetPath() {
        // remove leading/trailing slashes
        const parts = location.pathname.split('/').filter(Boolean);
        if (parts.length === 0) {
            return null;
        }
        // take last element (could be file name or id)
        const assetName = parts[parts.length - 1];
        // append .glb if not present
        let fileName = assetName;
        if (!fileName.toLowerCase().endsWith('.glb')) {
            fileName += '.glb';
        }
        return `/assets/${fileName}`;
    }

    // set viewer src based on path
    const viewer = document.getElementById('artifactViewer');
    const assetPath = getAssetPath();

    if (assetPath) {
        // optionally check existence before setting
        fetch(assetPath, { method: 'HEAD' })
            .then(resp => {
                if (resp.ok) {
                    viewer.src = assetPath;
                } else {
                    console.error('Asset not found:', assetPath, resp.status);
                    viewer.alt = 'Asset not found';
                }
            })
            .catch(err => {
                console.error('Error checking asset:', err);
                viewer.alt = 'Error loading asset';
            });
    } else {
        console.warn('No pathname provided; using default asset');
        viewer.src = '/assets/rock.glb';
    }

    function getMetadataPath() {
        const parts = location.pathname.split('/').filter(Boolean);
        if (parts.length === 0) return null;
        let fileName = parts[parts.length - 1];
        if (!fileName.toLowerCase().endsWith('.json')) {
            fileName += '.json';
        }
        return `/data/${fileName}`;
    }

    const metadataContainer = document.getElementById('metadata');
    const metadataPath = getMetadataPath();

    if (metadataPath) {
        fetch(metadataPath)
            .then(resp => {
                if (!resp.ok) {
                    throw new Error(`Status ${resp.status}`);
                }
                return resp.json();
            })
            .then(data => {

                metadataContainer.textContent = JSON.stringify(data, null, 2);
            })
            .catch(err => {
                console.error('Error loading metadata:', err);
                metadataContainer.textContent = 'Unable to load metadata';
            });
    } else {
        metadataContainer.textContent = 'No metadata path available';
    }

    console.log('location.href:', location.href);
    console.log('location.origin:', location.origin);
    console.log('location.pathname:', location.pathname);
    console.log('Asset path computed:', assetPath);
</script>